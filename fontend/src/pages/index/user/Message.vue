<script lang="ts" setup>
import { ref, onMounted } from 'vue';
import Tooltip from './Tooltip.vue';
import Cancel from './Cancel.vue';
import { getReviewLists, getReviewHistoryLists, updateUserReview, getInviteCode, updateInviteCode } from '../../../net/admin-home/get';
import { ElMessage } from 'element-plus';


const loading = ref(true);
const error = ref<string | null>(null);


const fetchUserAudits = async () => {
    loading.value = true;
    error.value = null;
    try {



    } catch (err: any) {
        error.value = err.message || 'Failed to fetch user audits.';
    } finally {
        loading.value = false;
    }
};



onMounted(() => {
    fetchUserAudits();
});
const tableData = ref([
    {
        iId: 1,
        aid: 1,
        date: '2016-05-03',
        name: 'Tom',
        email: 'INVITE123',
    },
])

const historyData = ref([
    {
        iId: 1,
        aid: 1,
        date: '2021-05-03',
        name: 'Tom',
        email: 'INVITE123',
        status: 'approved',
        result: '注册信息无误',
        auditTime: '2021-05-03 10:00:00',
    },
])


const code = ref('暂无数据')


const isShowLikePanel = ref(false);

const showHistory = ref(false);

const historyText = () => {

    if (showHistory.value) {
        getReviewList()
        return '待审核'
    } else {
        getReviewHistoryList()
        return '历史记录'
    }
};
// 处理时间格式 将yyyy-MM-dd HH:mm:ss 转化为 yyyy-MM-dd
const formatDate = (date: string) => {
    const year = date.slice(0, 4);
    const month = date.slice(5, 7);
    const day = date.slice(8, 10);
    return `${year}-${month}-${day}`;
};
const getReviewList = () => {
    getReviewLists(
        (data: any) => {
            console.log(data);
            tableData.value = []
            data.forEach((item: any) => {
                tableData.value.push({
                    iId: item.iid,
                    aid: item.aid,
                    date: formatDate(item.inviteTime),
                    name: item.username,
                    email: item.email,
                })
            });
        },
        (err) => {
        }
    )
}

const getReviewHistoryList = () => {
    getReviewHistoryLists(
        (data: any) => {
            console.log(data);
            historyData.value = []
            data.forEach((item: any) => {
                historyData.value.push({
                    iId: item.iid,
                    aid: item.aid,
                    date: formatDate(item.inviteTime),
                    name: item.username,
                    email: item.email,
                    status: item.status,
                    result: item.result,
                    auditTime: item.handleTime,
                })
            });
        },
        (err) => {
        }
    )
};

const handleAgree = (row: any) => {
    updateUserReview(
        row.aid,
        1,
        '通过',
        (data: any) => {
            ElMessage.success('操作成功');
            // 刷新列表
            getReviewList()
        },
        (err) => {
            console.log(err);
            ElMessage.error('操作失败');
        }
    );
};

const handleReject = (row: any) => {
    updateUserReview(
        row.aid,
        1,
        '拒绝',
        (data: any) => {
            ElMessage.success('操作成功');
            // 刷新列表
            getReviewHistoryList();
        },
        (err) => {
            console.log(err);
            ElMessage.error('操作失败');
        }
    );
};


const getCode = () => {
    getInviteCode(
        (data: any) => {
            console.log(data);
            code.value = data;
        },
        (err) => {
            console.log(err);
        }
    )
}

const handleUpdate = () => {
    updateInviteCode(
        (data: any) => {
            ElMessage.success('操作成功');
            getCode();
        },
        (err) => {
            console.log(err);
            ElMessage.error('操作失败');
        }
    )
}


onMounted(() => {
    getReviewList();
    getCode();
});



</script>

<template>
    <div>
        <div v-show="isShowLikePanel" class="loading-overlay">
            <!-- 审核流程可视化 -->
            <div class="process-flow">
                <Cancel @click="isShowLikePanel = false" style="margin-left: 96%;" />
                <h2 style="margin-top: -20px;">📋 审核流程图解</h2>
                <div class="steps">
                    <div class="step-card">
                        <div class="step-icon">①</div>
                        <h2>邀请码发放</h2>
                        <p>管理员生成唯一邀请码并分发给目标用户</p>
                    </div>
                    <div class="step-card">
                        <div class="step-icon">②</div>
                        <h2>用户注册</h2>
                        <p>用户使用有效邀请码完成注册流程</p>
                    </div>
                    <div class="step-card">
                        <div class="step-icon">③</div>
                        <h2>待审队列</h2>
                        <p>新注册用户进入待审核状态等待处理</p>
                    </div>
                    <div class="step-card">
                        <div class="step-icon">④</div>
                        <h2>人工审核</h2>
                        <p>管理员核查信息并决定通过/拒绝</p>
                    </div>
                    <div class="step-card">
                        <div class="step-icon">⑤</div>
                        <h2>结果通知</h2>
                        <p>通过站内信/邮件通知用户审核结果</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="user-center">
            <div class="header-section">
                <div style="display: flex;">
                    <h2 class="title">📝 用户审核管理</h2>
                    <Tooltip @click="isShowLikePanel = true"
                        style="height: 18px;transform: scale(0.3);margin-top: 14px;margin-left: -1px;" />
                </div>

                <p style="font-size: 16px;">邀请码：</p>
                <p style="font-size: 16px;color: #919399;">{{ code }}</p>
                <el-button type="success" @click="handleUpdate" style="width: 110px;">
                    <el-icon>
                        <svg t="1742730365063" class="icon" viewBox="0 0 1197 1024" version="1.1"
                            xmlns="http://www.w3.org/2000/svg" p-id="1523" width="200" height="200">
                            <path
                                d="M1197.292308 787.692308H0l64.496246-94.208L0 598.646154h1197.292308l-66.402462 94.838154z"
                                fill="#FF2655" p-id="1524"></path>
                            <path
                                d="M141.784615 208.502154c0-21.677292 16.320985-45.276554 35.761231-52.932923L570.446769 5.750154c20.0704-7.656369 52.082215-7.656369 72.152616 0l392.900923 149.819077c20.0704 7.656369 35.761231 31.255631 35.76123 52.932923v606.995692c0 21.677292-16.320985 45.276554-35.76123 52.932923l-392.900923 149.819077c-20.0704 7.656369-52.082215 7.656369-72.152616 0l-392.900923-149.819077C157.4912 860.7744 141.784615 837.159385 141.784615 815.497846v-606.995692z"
                                fill="#FFBA00" p-id="1525"></path>
                            <path
                                d="M209.368615 820.964431C189.109169 813.4656 173.292308 790.338954 173.292308 769.102769V222.775138c0-21.251938 16.462769-44.378585 36.076307-51.877415l360.763077-133.750154c20.259446-7.514585 52.523323-7.514585 72.78277 0l360.763076 133.750154c20.259446 7.498831 36.076308 30.625477 36.076308 51.877415V769.732923c0 21.251938-16.462769 44.378585-36.076308 51.877415l-360.763076 133.750154c-20.259446 7.514585-52.523323 7.514585-72.78277 0l-360.763077-134.380307z"
                                fill="#FD7B01" p-id="1526"></path>
                            <path
                                d="M346.253785 819.2c-10.113969 0-20.858092-0.630154-32.862523-2.567877L236.307692 806.344862l56.871385-54.019939c15.785354-14.792862 22.7328-34.075569 22.7328-59.8016V453.332677h-36.643446V354.934154h56.871384c-13.894892-15.438769-18.321723-33.445415-19.58203-45.654646a956.888615 956.888615 0 0 1-13.910647-77.824L296.975754 189.046154h166.801723l1.890461 35.367384 1.890462 21.220431h15.170954c4.411077-8.349538 8.837908-18.652554 12.634584-30.877538L503.571692 189.046154h152.276677l-6.317292 43.086769c-0.630154 5.135754-1.890462 9.641354-2.520615 14.777108a71.648492 71.648492 0 0 1 22.7328 9.657107c1.890462-10.933169 4.426831-23.158154 6.317292-36.013292l5.056984-30.877538h141.532554l-6.931692 43.732677c-1.906215 10.287262-3.812431 23.158154-6.333046 38.596923h92.254523v100.934892h-12.004431l-0.630154 2.583631a4087.240862 4087.240862 0 0 1-46.127261 160.752246c-2.520615 10.287262-5.056985 18.006646-6.317293 24.418461 37.903754 108.039877 54.965169 131.182277 59.392 135.687877L945.230769 746.543262l-38.549661 7.719384v57.863877h-355.091693c-30.326154 0-74.5472-4.5056-107.409723-28.293908C421.431138 806.344862 388.568615 819.2 346.269538 819.2z"
                                fill="#6B1B1C" p-id="1527"></path>
                            <path
                                d="M698.415262 525.548308h-133.435077v58.052923c4.411077-21.693046 20.779323-32.547446 48.45883-32.547446 52.255508-3.182277 76.8 17.864862 73.649231 63.172923v29.979569c1.260308 47.860185-16.368246 71.459446-52.869908 70.183385-35.241354 0-61.061908-12.130462-78.044553-37.005785-7.561846 20.416985-34.626954 29.995323-80.580923 29.995323 11.972923 21.693046 45.323815 31.901538 98.823876 29.979569H882.215385v25.521231H564.980185c-67.347692 0-105.109662-21.693046-112.671508-65.063385-9.452308 57.407015-49.088985 81.652185-119.587446 72.0896 22.654031-21.693046 34.6112-50.412308 34.6112-86.14203V439.406277c0-20.416985-6.301538-29.995323-18.242954-29.995323H330.830769V385.811692h71.128616c33.981046 1.260308 50.349292 19.140923 50.349292 53.594585v221.3888c4.411077 17.234708 10.082462 29.995323 16.368246 39.557908 16.9984-21.693046 25.174646-58.698831 25.174646-111.647508v-63.172923H470.567385v-23.599262h66.717538v-37.021538h87.496862v37.021538h73.633477v23.599262zM353.4848 220.553846h89.387323c1.260308 26.151385 5.041231 51.042462 11.342769 74.657477 4.395323 20.416985 13.201723 35.729723 25.158893 46.568369-73.633477 7.656369-110.781046-7.010462-112.671508-44.016246-3.780923-19.140923-8.176246-44.662154-13.217477-77.2096z m372.625723 0h66.717539c-3.150769 18.510769-7.546092 45.938215-13.847631 81.667939h98.823877v25.52123h-105.739816v4.474093c0 29.349415-27.695262 43.386092-82.45563 42.11003v18.495016c4.411077 49.782154-23.914338 72.105354-84.976247 67.631261-25.8048 1.276062-40.912738-6.380308-43.433353-23.599261v23.599261H482.540308V276.700554h34.6112c10.712615-14.036677 20.149169-32.531692 27.695261-56.146708h82.455631c-3.150769 20.416985-9.436554 38.281846-18.242954 53.594585h16.368246c44.677908-1.276062 66.087385 21.062892 64.196923 67.631261v21.062893c11.972923-21.693046 23.914338-69.553231 36.501662-142.288739zM610.934154 637.195815V616.132923c0-28.073354-8.192-40.833969-25.174646-39.542154-9.452308 0-16.384 7.640615-20.779323 23.599262v2.552123c0 37.005785-2.520615 61.250954-6.931693 72.0896 0 1.276062 0.630154 2.552123 2.520616 2.552123 9.452308 3.198031 17.644308 3.828185 25.1904 2.552123 16.982646 0.630154 25.174646-12.760615 25.174646-42.740185z m-50.365046-320.937353v35.099569h50.365046v-25.521231c0-18.510769-9.452308-28.073354-27.695262-28.073354-11.972923-0.630154-19.519015 5.7344-22.669784 18.495016z m50.365046 83.589907v-28.073354h-50.365046v46.56837c6.301538 12.760615 13.863385 18.510769 23.299938 18.510769 16.352492 0 25.8048-12.130462 27.065108-37.021539z m84.976246 2.552123h64.196923c1.260308 6.380308 3.150769 13.390769 4.411077 21.047139 6.301538 15.312738 10.696862 27.4432 13.847631 35.099569 6.301538-29.349415 15.092185-63.172923 27.695261-100.178708h59.785846a4378.466462 4378.466462 0 0 1-45.938215 158.231631c-4.411077 17.234708-7.561846 29.349415-9.452308 37.021539 30.846031 88.6784 54.130215 140.996923 71.128616 158.215876-56.650831 10.8544-89.371569-10.838646-98.823877-65.063384-13.847631 56.130954-47.198523 78.454154-101.328739 67.615508 24.544492-35.729723 47.198523-89.324308 69.238154-160.783754a10098.057846 10098.057846 0 0 0-54.760369-151.205416z"
                                fill="#FFFFFF" p-id="1528"></path>
                            <path
                                d="M1118.523077 786.432C1011.822277 730.584615 815.671138 693.169231 591.399385 693.169231 365.883077 693.169231 169.086031 731.230523 63.015385 787.692308l112.450953 189.046154c95.200492-39.337354 246.626462-64.701046 416.578954-64.701047 169.322338 0 319.472246 25.363692 414.672739 64.070893L1118.523077 786.432z"
                                fill="#FF2655" p-id="1529"></path>
                            <path
                                d="M177.482831 992.492308L63.015385 792.512985l3.780923-1.953477C175.608123 730.820923 377.336123 693.169231 591.714462 693.169231c213.133785 0 413.601477 37.021538 523.027692 96.098461l3.780923 1.937723-114.467446 200.640985-3.150769-1.307569c-98.036185-41.542892-247.288123-64.9216-409.1904-64.9216-163.162585 0-312.398769 24.024615-411.065108 65.583261l-3.166523 1.291816zM73.759508 795.758277l106.889846 186.998154c99.280738-41.558646 248.532677-64.937354 410.434954-64.937354 161.272123 0 309.878154 23.378708 408.544492 64.275692l107.504246-187.628307c-109.394708-57.800862-306.097231-93.499077-516.048738-93.499077-210.597415 0.630154-408.544492 36.359877-517.3248 94.790892z"
                                fill="#FFFFFF" p-id="1530"></path>
                            <path
                                d="M267.815385 800.295385l25.3952-4.489847 11.421538 68.387447-6.978954 1.291815-1.260307-8.318031-10.807139 1.921969 1.260308 8.948185-6.9632 1.276062L267.815385 800.295385z m19.0464 3.828184l-10.791385 1.921969 7.609108 46.647139 10.791384-1.921969-7.609107-46.647139z m15.233969 28.120616l26.655508-4.474093-5.718647-34.500923c-6.978954 1.890462-15.233969 3.828185-23.47323 5.7344-0.630154-1.906215-1.906215-4.474092-2.552123-6.380307a513.165785 513.165785 0 0 0 53.956923-13.422277l1.906215 6.380307c-6.978954 1.921969-14.588062 3.843938-22.843077 5.750154l5.702892 35.162585 26.671262-4.474093 1.260308 7.026216-26.655508 4.474092 4.442585 26.198646c1.260308 7.672123-1.260308 12.146215-8.255016 13.422277-3.812431 0.645908-8.885169 1.291815-15.233969 2.567877a39.242831 39.242831 0 0 0-3.166523-7.672123c6.3488-0.630154 11.421538-1.276062 14.588061-1.921969 3.182277-0.630154 5.088492-2.552123 4.442585-6.396062l-3.796677-24.276677-26.671261 4.474093-1.260308-7.672123z m0-26.198647l5.702892-3.843938c5.088492 6.396062 9.531077 12.792123 13.343508 19.172431l-6.3488 5.12c-3.812431-7.672123-8.255015-14.068185-12.6976-20.448493z m38.077046 12.760616c3.182277-8.932431 5.718646-16.604554 6.994708-24.260923l7.609107 1.906215c-2.536369 8.948185-5.702892 17.250462-8.255015 24.292431l-6.3488-1.921969z m31.744-42.173046l32.374154-3.828185 8.255015 77.981539c0.630154 6.380308-2.536369 10.224246-8.885169 10.870153-3.182277 0.630154-6.994708 0.630154-10.791385 1.260308-0.630154-2.552123-1.260308-4.474092-1.906215-7.026215 3.812431 0 7.609108 0 10.161231-0.630154 3.166523-0.645908 4.442585-1.921969 4.442584-5.12l-2.552123-21.0944-19.030646 1.921969c0.630154 14.052431-1.276062 26.198646-5.718646 37.0688-1.890462-1.921969-4.442585-3.198031-6.3488-4.474092 5.072738-10.24 6.3488-23.000615 4.442585-38.990769l-4.442585-47.938954z m26.025354 3.843938l-19.0464 1.906216 1.906215 17.896369 19.0464-1.906216-1.890461-17.896369z m-13.957908 44.110769l19.030646-1.937723-1.890461-17.896369-19.062154 1.921969 1.921969 17.89637z m31.098092-53.058953l36.816739-3.843939 8.255015 77.981539c0.630154 7.672123-2.536369 11.500308-9.531077 12.130461-3.166523 0.645908-6.978954 0.645908-11.421538 1.291815-0.630154-1.921969-1.260308-4.474092-1.890462-7.026215 3.796677 0 7.609108 0 10.775631-0.630154 3.182277-0.661662 5.088492-2.567877 4.442585-5.765907l-2.520616-22.370462-23.504738 2.552123c0.630154 14.698338-1.260308 26.844554-6.3488 37.0688-1.890462-1.906215-4.442585-3.198031-6.3488-4.474092 5.718646-10.224246 6.994708-23.630769 5.088492-40.266831l-3.812431-46.647138z m30.467939 3.19803l-22.843077 2.552123 1.890462 17.89637 22.843076-2.552123-1.890461-17.89637z m-18.400492 44.740923l22.843077-2.567877-1.890462-17.896369-22.858831 2.567877 1.890462 17.896369z m41.889477-46.032738l23.47323-1.260308 3.812431 66.465477-16.494277 0.630154 0.630154 7.672123-6.978954 0.630154-4.442584-74.1376z m17.140184 5.765908l-9.531077 0.630153 3.182277 53.058954 9.515323-0.645907-3.166523-53.0432z m12.051692 40.896984l6.3488-0.630154-1.260307-27.490461c-1.906215-1.276062-3.182277-2.552123-5.718646-4.474092 8.255015-8.302277 13.973662-18.542277 18.416246-29.396677l7.609107 0.630153c-1.260308 3.198031-3.166523 6.396062-4.442584 9.594093l27.931569-1.276062 0.630154 6.380308c-2.520615 3.843938-6.3488 8.318031-10.791385 14.068185l17.770339-1.276062 1.906215 29.396677 6.994708-0.630154 0.630154 6.380308-27.301416 1.276061c6.3488 10.870154 15.879877 17.896369 29.207631 19.818339-1.906215 2.552123-3.812431 5.12-5.088492 7.672123-13.327754-4.474092-23.473231-12.130462-29.822031-24.292431-3.812431 11.500308-13.973662 21.110154-29.207631 28.120615a25.915077 25.915077 0 0 0-5.718646-6.380307c15.879877-6.396062 25.3952-14.698338 28.577477-24.938339l-25.3952 1.291816-1.260308-3.843939z m39.999016-44.740923l-22.843077 1.276062c-2.552123 4.474092-6.364554 9.594092-9.531077 14.068184l22.212923-1.276061c3.812431-5.750154 7.624862-10.870154 10.161231-14.068185z m-26.655508 44.110769l13.957908-0.645907c0.630154-4.474092 0.630154-12.130462 0-23.000616l-15.233969 0.630154 1.260307 23.000616z m36.170831-24.938338l-15.233969 0.630154c0.630154 10.870154 0.630154 18.542277 0.630154 23.016369l15.879876-0.630154-1.260307-23.000615z m21.582769-23.000615h27.301416l1.890461-15.344247 8.255015 1.276062c-0.630154 5.12-1.260308 9.594092-1.890461 14.068185h56.493292v7.672123h-57.769354c-1.260308 5.104246-1.890462 9.578338-3.166523 14.698338h50.774646v7.026215c-5.072738 13.422277-11.421538 23.646523-20.952615 31.318647 8.885169 5.750154 19.692308 9.594092 33.020062 11.500307a77.540431 77.540431 0 0 0-6.3488 8.948185c-13.343508-3.828185-24.134892-8.948185-33.020062-15.328492-9.515323 6.380308-20.952615 12.130462-34.910523 16.604553-1.890462-2.552123-3.796677-5.104246-5.072738-7.672123 13.327754-3.828185 24.749292-8.302277 33.634461-14.05243-8.885169-8.302277-15.233969-18.542277-19.030646-31.318647-6.3488 21.0944-15.233969 37.0688-26.671262 48.569108-1.890462-2.552123-3.166523-4.474092-5.072738-6.380308 13.957908-14.068185 23.473231-35.162585 29.207631-63.2832H570.604308l-1.260308-8.302276z m72.373169 28.120615h-36.186584c3.812431 10.870154 9.515323 19.818338 17.770338 26.198646a49.908185 49.908185 0 0 0 18.416246-26.198646z m119.335385 41.542892a46.552615 46.552615 0 0 0-5.718646 7.026216c-16.510031-8.302277-29.191877-18.526523-38.0928-31.318647l-1.890462 37.0688-7.624861-0.630153 1.906215-37.714708c-10.161231 10.870154-23.473231 20.448492-40.629169 29.396677-1.260308-1.906215-3.166523-4.474092-5.072739-7.026216 17.140185-7.672123 31.744-16.620308 43.795693-27.474707l-40.629169-1.921969 0.630153-7.026216 43.165539 1.906216 1.276061-25.568493-37.446892-1.906215 0.630154-7.041969 37.446892 1.921969 0.630154-14.052431 7.624862 0.630154-0.630154 14.068185 38.0928 1.906215v7.041969l-38.0928-1.921969-1.260308 25.568492 43.165539 1.921969v7.026216l-41.275077-1.921969c8.885169 12.792123 22.212923 22.370462 39.999015 30.042584z m-78.721969-56.241231l5.718646-4.474092c4.442585 5.104246 8.885169 10.224246 12.6976 15.9744l-6.3488 5.12c-3.182277-4.474092-6.978954-10.24-12.067446-16.620308z m45.701907 14.052431c6.3488-5.750154 10.791385-11.500308 14.603816-15.9744l6.3488 5.750154c-5.072738 5.750154-10.161231 10.870154-15.864123 15.344246l-5.088493-5.12z m57.769354-14.698338l6.3488 0.630154-2.536369 26.2144c-0.630154 6.396062-1.906215 12.130462-3.182277 17.266215 4.442585 4.474092 8.255015 9.578338 12.067446 14.052431l-5.072738 4.474092c-3.182277-4.474092-5.718646-8.302277-8.885169-12.130461-3.812431 9.578338-9.531077 16.604554-17.140185 21.724553-1.276062-1.921969-2.552123-4.474092-4.442585-6.396061 11.421538-6.396062 18.400492-19.172431 20.306708-39.620923l2.536369-26.2144z m-10.791384-15.9744l30.467938 3.198031-6.3488 61.991384-6.3488-0.630154 5.718646-54.980923-17.770338-1.906215-5.718646 55.611077-6.3488-0.645908 6.3488-62.637292z m30.467938 53.689107l12.6976 1.260308 1.260308-9.578338-15.864123-1.906216 0.630154-5.12 15.879877 1.92197 1.260307-8.948185-12.681846-1.276062 0.630154-5.12 12.6976 1.276062 0.630154-8.302277-13.957908-1.276062 0.630154-5.12 13.327754 1.276062a168.723692 168.723692 0 0 0-5.718646-10.870154l6.3488-2.552123c2.552123 3.843938 4.442585 7.672123 6.3488 11.500308l-4.442585 2.567877 14.603815 1.276061c3.166523-4.474092 5.718646-8.948185 8.255016-13.422277l6.978954 3.828185c-2.536369 3.198031-5.072738 7.041969-7.609108 10.24l16.494277 1.906215-0.630154 5.12-18.416246-1.921969-0.630154 8.318031 15.233969 1.906215-1.260307 14.698339 5.702892 0.645907-0.630154 5.12-5.718646-0.645907-1.890462 18.542277-5.718646-0.645908 0.630154-3.828185-7.624862-0.645907c3.812431 10.24 9.531077 18.526523 17.140185 24.922584-1.890462 1.276062-3.796677 3.198031-5.702892 5.750154-6.3488-7.672123-11.437292-15.328492-13.973662-24.276677l-3.166523 27.474708-6.3488-0.630154 3.812431-33.240615-9.531077-1.276062-3.796677 33.240615-6.3488-0.645907 3.166523-26.844554a70.687508 70.687508 0 0 1-22.212923 21.0944 112.104369 112.104369 0 0 1-2.536369-7.041969 52.554831 52.554831 0 0 0 23.473231-20.448493l-10.791385-1.260307-0.630154-7.04197z m19.0464 1.92197l9.515323 1.260307 1.276062-9.578338-9.515323-1.276062-1.276062 9.594093z m1.260308-14.714093l9.531077 1.291816 1.260307-8.948185-9.515323-1.291815-1.260307 8.948184z m1.906215-14.698338l9.531077 1.276061 0.630154-8.302276-9.515323-1.276062-0.630154 8.302277z m12.067446 31.318646l9.515323 1.276062 1.276062-9.578339-9.515323-1.276061-1.276062 9.578338z m11.421539-23.000615l-9.515323-1.276062-1.260308 8.948185 9.515323 1.260307 1.260308-8.93243z m15.233969 21.0944l13.327754 2.552123 2.552123-13.422277-5.088492-1.276062 0.630154-5.12c-1.890462 2.552123-3.796677 4.474092-5.702893 6.396062l-3.812431-7.672123a122.391631 122.391631 0 0 0 20.952616-31.318646l6.978954 3.19803c-1.890462 3.828185-4.442585 7.672123-6.3488 10.870154l19.0464 3.182277-1.260308 7.041969-21.582769-3.843938c-2.552123 3.198031-4.458338 6.396062-6.994708 9.594092l24.765046 4.474093-1.276061 7.026215-12.6976-2.552123-2.53637 13.422277 13.957908 2.552123-1.260308 7.026215-13.973661-2.552123-3.796677 20.448492c4.442585-1.906215 9.515323-3.828185 15.864123-6.380307v7.656369c-6.978954 2.567877-12.6976 5.12-17.140185 7.041969-2.536369 1.260308-4.442585 2.552123-6.3488 3.198031l-3.81243-7.672123c2.552123-1.921969 4.442585-3.843938 5.088492-7.041969l3.166523-19.172431-13.327754-2.552123 0.630154-5.104246z m27.301415 41.542892a94.885415 94.885415 0 0 0 26.655508-9.594092c-1.890462-7.026215-2.520615-14.698338-2.520615-24.292431l-14.619569-0.630154V823.926154l14.603815 0.630154c0-4.474092 0.630154-8.948185 1.260308-14.052431l-12.681847-0.645908v-7.026215l13.327754 1.260308c0.630154-7.010462 1.890462-14.682585 3.812431-22.370462l7.609108 1.291815c-1.260308 7.672123-2.520615 15.344246-3.166523 21.740308l33.004307 2.552123-0.630153 7.026216-33.650216-2.552124c-0.630154 5.104246-1.260308 9.578338-1.260308 13.422277l33.004308 1.906216-0.630154 7.041969-33.020061-1.921969c0 7.672123 0 14.052431 1.906215 19.818338a84.535138 84.535138 0 0 0 19.0464-14.698338l5.072739 5.750154c-6.978954 6.380308-13.957908 11.500308-21.58277 16.604553 1.906215 4.474092 4.442585 8.318031 8.255016 11.500308 3.812431 3.213785 6.3488 3.213785 7.624861-1.260308 1.890462-5.12 3.796677-9.594092 5.072739-14.068184 2.536369 1.276062 4.442585 2.552123 6.3488 3.828184-2.536369 7.672123-4.442585 12.792123-6.3488 15.990154-2.536369 5.104246-5.718646 7.026215-10.161231 6.380308-3.796677-0.630154-6.978954-2.552123-10.145477-6.380308a36.281108 36.281108 0 0 1-7.624861-11.500307 156.750769 156.750769 0 0 1-26.025354 9.578338c0.630154-3.198031-0.630154-5.750154-2.53637-8.302277z m43.795693-76.705477l5.088492-3.828185c4.442585 4.474092 8.239262 8.948185 11.421539 12.77637l-5.718647 4.474092c-3.812431-4.474092-7.609108-8.948185-10.791384-13.422277zM983.8592 852.141292L1019.305354 834.953846 1039.753846 864.728615l-35.4304 17.171693-20.464246-29.759016zM208.738462 882.215385L173.292308 865.027938l20.464246-29.774769 35.4304 17.187446L208.722708 882.215385z"
                                fill="#FFFFFF" p-id="1531"></path>
                        </svg>
                    </el-icon>
                    创建邀请码
                </el-button>

                <el-button type="primary" @click="showHistory = !showHistory">
                    <el-icon>
                        <svg t="1740989754269" class="icon" viewBox="0 0 1024 1024" version="1.1"
                            xmlns="http://www.w3.org/2000/svg" p-id="1505" width="200" height="200">
                            <path d="M512 512m-512 0a512 512 0 1 0 1024 0 512 512 0 1 0-1024 0Z" fill="#E9F7FA"
                                p-id="1506"></path>
                            <path
                                d="M248.271249 220.20994m3.567116 0l299.637715 0q3.567116 0 3.567116 3.567115l0 299.637715q0 3.567116-3.567116 3.567116l-299.637715 0q-3.567116 0-3.567116-3.567116l0-299.637715q0-3.567116 3.567116-3.567115Z"
                                fill="#24A5CC" p-id="1507"></path>
                            <path
                                d="M546.957733 229.008825v288.936368H257.070135V229.008825H546.957733m5.469578-17.835578H251.838365a12.603809 12.603809 0 0 0-12.603809 12.603808V523.176962a12.366001 12.366001 0 0 0 12.603809 12.366001h299.637715a12.366001 12.366001 0 0 0 12.366001-12.366001V223.777055a12.366001 12.366001 0 0 0-12.366001-12.603808z"
                                fill="#170901" p-id="1508"></path>
                            <path
                                d="M449.218765 430.194148a9.036693 9.036693 0 0 1-6.183001-2.615885l-95.123084-95.123084a8.798885 8.798885 0 0 1 12.603809-12.603809l95.123084 95.123084a8.798885 8.798885 0 0 1 0 12.603809 9.274501 9.274501 0 0 1-6.420808 2.615885z"
                                fill="#FFFFFF" p-id="1509"></path>
                            <path
                                d="M353.857873 430.194148a9.036693 9.036693 0 0 1-6.183001-2.615885 8.798885 8.798885 0 0 1 0-12.603809l95.123084-95.123084a8.798885 8.798885 0 0 1 12.603809 12.603809l-95.123084 95.123084a9.512308 9.512308 0 0 1-6.420808 2.615885z"
                                fill="#FFFFFF" p-id="1510"></path>
                            <path
                                d="M563.842081 760.984673a193.813284 193.813284 0 1 1 193.813284-193.813284A194.051092 194.051092 0 0 1 563.842081 760.984673z"
                                fill="#FF912E" p-id="1511"></path>
                            <path
                                d="M563.842081 383.108221a184.776591 184.776591 0 1 1-184.776591 184.776591 185.014399 185.014399 0 0 1 184.776591-184.776591m0-17.835578a202.612169 202.612169 0 1 0 202.612169 202.612169 202.849977 202.849977 0 0 0-202.612169-202.612169z"
                                fill="#170901" p-id="1512"></path>
                            <path
                                d="M563.842081 567.884812m-151.721319 0a151.721319 151.721319 0 1 0 303.442638 0 151.721319 151.721319 0 1 0-303.442638 0Z"
                                fill="#FFFFFF" p-id="1513"></path>
                            <path
                                d="M523.176962 503.438922l39.238273 63.494659a4.756154 4.756154 0 0 0 7.847654 0l39.238272-63.494659a4.756154 4.756154 0 0 1 4.042731-2.140269h25.683233L578.823967 594.519275a4.518346 4.518346 0 0 0 0 2.378078v61.830004h-23.780771v-61.592197a4.518346 4.518346 0 0 0 0-2.378077l-60.403159-93.45843h25.683233a4.756154 4.756154 0 0 1 2.853692 2.140269zM818.058523 401.89503a8.798885 8.798885 0 0 1-8.798885-9.036693 164.800743 164.800743 0 0 0-164.562936-164.325128 9.036693 9.036693 0 0 1-9.036693-9.036693 8.798885 8.798885 0 0 1 9.036693-8.798885 182.636321 182.636321 0 0 1 182.398514 182.160706 9.036693 9.036693 0 0 1-9.036693 9.036693z"
                                fill="#FF912E" p-id="1514"></path>
                            <path
                                d="M821.625639 428.053878l31.15281-38.524849a4.518346 4.518346 0 0 0-3.567116-7.372039h-62.30562a4.518346 4.518346 0 0 0-3.567116 7.372039L814.491407 428.053878a4.756154 4.756154 0 0 0 7.134232 0z"
                                fill="#FF912E" p-id="1515"></path>
                            <path
                                d="M380.492336 821.625639a182.636321 182.636321 0 0 1-182.398513-182.398514 8.798885 8.798885 0 0 1 9.036693-8.798885 8.561078 8.561078 0 0 1 8.798885 8.798885A164.800743 164.800743 0 0 0 380.492336 803.79006a9.036693 9.036693 0 1 1 0 17.835579z"
                                fill="#24A5CC" p-id="1516"></path>
                            <path
                                d="M202.374361 605.45843L171.221551 643.745471a4.756154 4.756154 0 0 0 3.567116 7.609847H237.80771a4.756154 4.756154 0 0 0 3.804924-7.609847l-32.104041-38.287041a4.518346 4.518346 0 0 0-7.134232 0z"
                                fill="#24A5CC" p-id="1517"></path>
                        </svg>
                    </el-icon>
                    {{ historyText() }}
                </el-button>

            </div>

            <!-- 数据加载状态 -->
            <div v-if="loading" class="loading-state">
                <div class="loader"></div>
                <span>数据加载中...</span>
            </div>

            <!-- 数据展示区域 -->
            <template v-else>
                <div v-if="error" class="error-alert">
                    ⚠️ {{ error }}
                </div>

                <div v-if="!isShowLikePanel">
                    <!-- 审核数据表格 -->
                    <div class="table-wrapper">
                        <el-table v-if="!showHistory" :data="tableData" style="width: 100%" height="250">
                            <el-table-column fixed prop="date" label="注册时间" width="150" />
                            <el-table-column prop="name" label="用户名" width="120" />
                            <el-table-column prop="email" label="邮箱" width="200" />
                            <el-table-column label="操作" width="220">
                                <template #default="scope">
                                    <el-button size="small" type="success" @click="handleAgree(scope.row)">
                                        同意
                                    </el-button>
                                    <el-button size="small" type="danger" @click="handleReject(scope.row)">
                                        拒绝
                                    </el-button>
                                </template>
                            </el-table-column>
                        </el-table>
                        <el-table v-if="showHistory" :data="historyData" style="width: 100%" height="250">
                            <el-table-column fixed prop="date" label="注册时间" width="150" />
                            <el-table-column prop="name" label="用户名" width="120" />
                            <el-table-column prop="email" label="邮箱" width="200" />
                            <el-table-column prop="result" label="审核结果" width="120">
                                <template #default="scope">
                                    <span :style="{ color: scope.row.result === '通过' ? '#67c23a' : 'red' }">
                                        {{ scope.row.result }}
                                    </span>
                                </template>
                            </el-table-column> <el-table-column prop="auditTime" label="审核时间" width="150" />
                        </el-table>
                        <div v-if="tableData.length === 0 && historyData.length === 0" class="empty-state">
                            🗃️ 暂无审核数据
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </div>
</template>

<style scoped>
.el-table .warning-row {
    --el-table-tr-bg-color: var(--el-color-warning-light-9);
}

.el-table .success-row {
    --el-table-tr-bg-color: var(--el-color-success-light-9);
}

/* 整体布局 */
.user-center {
    max-width: 600px;
    /* Increased max-width */
    margin: 2rem auto;
    padding: 2rem;
    border: 1px solid #ddd;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    background-color: #fff;

}

.header-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
}

.title {
    color: #2c3e50;
    font-size: 1.2rem;
    border-left: 4px solid #3498db;
    padding-left: 1rem;
}

/* 表格样式 */
.table-wrapper {
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    margin-top: -20px;
    font-size: 16px;
}

.audit-table {
    width: 100%;
    background: white;
    border-collapse: collapse;

    th {
        background: #3498db;
        color: white;
        padding: 1rem;
        font-weight: 500;
    }

    td {
        padding: 1rem;
        border-bottom: 1px solid #eee;
    }

    tr:hover {
        background: #f5f7fa;
    }
}

.invite-code {
    padding: 4px 12px;
    font-size: 0.9em;
}

/* 状态标签 */
.status-badge {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.9em;
    margin-left: 40px;

    &.status-pending {
        background: #fff3cd;
        color: #856404;
    }

    &.status-approved {
        background: #d4edda;
        color: #155724;
    }

    &.status-rejected {
        background: #f8d7da;
        color: #721c24;
    }
}


/* 操作按钮 */
.action-buttons {
    display: flex;
    gap: 0.5rem;

    button {
        padding: 6px 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s;

        &:hover {
            transform: translateY(-1px);
        }
    }

    .btn-approve {
        background: #28a745;
        color: white;
    }

    .btn-reject {
        background: #dc3545;
        color: white;
    }
}

/* 流程步骤 */
.process-flow {
    width: 1200px;
    margin: 3rem 0;
    padding: 2rem;
    background: white;
    border-radius: 12px;
    font-size: 16px;

    .steps {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-top: 1.5rem;
    }

    .step-card {
        text-align: center;
        padding: 1.5rem;
        background: #f8f9fa;
        border-radius: 8px;

        .step-icon {
            width: 40px;
            height: 40px;
            background: #3498db;
            color: white;
            border-radius: 50%;
            margin: 0 auto 1rem;
            line-height: 40px;
        }
    }
}

/* 用户状态卡片 */
.user-status-card {
    margin-top: 2rem;
    padding: 2rem;
    background: white;
    border-radius: 12px;

    .status-details {
        display: grid;
        gap: 1rem;

        .detail-item {
            display: flex;
            align-items: center;
            gap: 1rem;

            label {
                color: #6c757d;
                min-width: 80px;
            }
        }
    }
}

/* 加载状态 */
.loading-state {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;

    .loader {
        width: 24px;
        height: 24px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 1rem;
    }
}

@keyframes spin {
    0% {
        transform: rotate(0deg);
    }

    100% {
        transform: rotate(360deg);
    }
}

/* 空状态提示 */
.empty-state {
    text-align: center;
    padding: 3rem;
    color: #6c757d;
    font-size: 1.1rem;
}

.loading-overlay {
    position: fixed;
    top: 0;
    right: 0;
    width: 100%;
    height: 100%;
    background-color: #99d1ff;
    background-image: radial-gradient(at 21% 94%, hsla(270, 95%, 76%, 1), transparent 50%),
        radial-gradient(at 56% 5%, hsla(252, 65%, 79%, 1) 0, transparent 50%),
        radial-gradient(at 67% 94%, hsla(194, 81%, 67%, 1) 0, transparent 50%),
        radial-gradient(at 15% 72%, hsla(304, 97%, 77%, 1) 0, transparent 50%),
        radial-gradient(at 63% 56%, hsla(38, 98%, 63%, 1) 0, transparent 50%),
        radial-gradient(at 41% 67%, hsla(321, 61%, 77%, 1) 0, transparent 50%),
        radial-gradient(at 68% 68%, hsla(263, 67%, 69%, 1) 0, transparent 50%);
    /* 半透明背景 */
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2;
    /* 确保遮罩层在最上层 */
}
</style>