<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.x.backend.mapper.admin.BookMapper">

    <!-- insertBook -->
    <insert id="insertBook">
        insert into book(name, author, description, rating, users, img, introduction)
        values (#{name}, #{author}, #{description}, #{rating}, #{users}, #{img}, #{introduction})
    </insert>

    <!--  给书籍评分  -->
    <insert id="score">
        insert into book_score (b_id, a_id, score)
        values (#{bId}, #{aId}, #{score})
    </insert>
    <insert id="batchUpdateScore">
        INSERT INTO book_score (b_id, a_id, score) VALUES
        <foreach collection="list" item="item" separator=",">
            (#{item.bId}, #{item.aId}, #{item.score})
        </foreach>
    </insert>

    <update id="updateBookRatingAndUsers">
        UPDATE book
        SET rating = ROUND((rating * users + #{rating} * #{users}) / (users + #{users}), 1),
            users  = users + #{users}
        WHERE id = #{bId};
    </update>
</mapper>